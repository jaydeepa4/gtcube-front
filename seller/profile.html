<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Login Form</title>
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
   <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css">
  <!-- or -->
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
<style>
/*blue-4cdef5
green-a4d555
blue-grey -424a5d

sky blue-Dashgum - 68dff0*/

/* 1. Green- 4abdac
      Red - fc4a1a
      Orange- F7b733
      grey - DFDCe3
    */
nav{
  /*background-color:#4abdac;*/
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#77c9d4+0,77c9d4+0,57bc90+100 */
background: #77c9d4; /* Old browsers */
background: -moz-linear-gradient(-45deg, #77c9d4 0%, #77c9d4 0%, #57bc90 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(-45deg, #77c9d4 0%,#77c9d4 0%,#57bc90 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(135deg, #77c9d4 0%,#77c9d4 0%,#57bc90 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#77c9d4', endColorstr='#57bc90',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
  height:9.5vh;
}

nav ul li.active{
  background-color:#F7b733;
}

nav ul li:hover{
   background-color:#F7b733;
}

#sidebar{
  background-color:#424a5d;
  color:#aeb2b7;
  min-height:90vh;
  margin-top:2px;
}

.sidebaritem:hover{
   background-color:#77c9d4/*68dff0*/;

   color:white;
}

.sidebaritem{
  padding:10px;
  cursor:pointer;
}

#update_button{
  background-color:#a4d555;
}

.brand-logo{
  margin-left:10px;
  margin-top:2px;
}

#maincontent{
  background-color:#f4f4f4;
  min-height:90vh;;
}

</style>

  <!-- Compiled and minified JavaScript -->
  
  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>      
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <!-- <link rel="stylesheet" href="css/style.css"> -->
  <!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.0/axios.js"></script>
</head>


<body>
  <!-- Header -->
   <nav>
    <div class="nav-wrapper">
      <a href="#" class="brand-logo"><img src='https://www.logogarden.com/wp-content/uploads/lg-logo-samples/Beauty-Logo-4.png' width='60vh'></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li class='active'><a href="profile.html">Profile</a></li>
        <li><a href="courses.html">Available Courses</a></li>
        <li><a href="coursedetail.html">Your Courses</a></li>
        <li><a href="logout.html">Logout</a></li>
      </ul>
    </div>
  </nav>
  <!-- Header ends here -->
  <div class='row'>
  <!-- Side Nav Bar -->
  <div class="col s12 m4 l3" id='sidebar'>
    <ul>
    <li id='item1' class='sidebaritem'>Item 1</li>
    <li id='item2' class='sidebaritem'>Item 1</li>
    <li id='item3' class='sidebaritem'>Item 1</li>
    <li id='item4' class='sidebaritem'>Item 1</li>
    <li id='item5' class='sidebaritem'>Item 1</li>
  </ul>
  </div>
  <!-- Side Nav Bar Ends here -->
      
  <!-- Main Content -->
  <div class="col s12 m8 l9" id='maincontent'>
  <section class="container">
    <div class="login">
      <h1>User Profile</h1>
        <div class='row'>
        <div class='col s6'>
          <p id='display_image'></p>
          <p><label for='display_image_field'><input name='display_image_field' id='display_image_field' type='file' value=''></label></p>
        </div>
        <div class='col s6'>
        <p><input disabled id='email' type="text" name="login" value="" placeholder="Email"></p>
        <p><input id='phone' type="text" name="phone" value="" placeholder="Phone"></p>
         <p><input id='country' type="text" name="country" value="" placeholder="Country"></p>
        </div>
        <div class='col s6 offset-s6'>
        <p id='update_button' class="col s12 waves-effect waves-light btn"><input id ='update' type="submit" name="update" value="Update"></p>
        </div>
    </div>
  </div>
  </div>
  </section>
  <!-- Main Content -->
</div>
</body>
<script>
var user_id = ''
var user_details = ''
var formData =  new FormData();

$(document).ready(function(){

  function addHoverAnimation(className,animation, infinite=0){
    $(className).hover(
    function(){
      if (infinite == 0) {
        $(this).addClass('animated '+ animation);
      }else{
        $(this).addClass('animated infinite '+ animation);
      }
      
  }, 
  function(){
    if (infinite == 0) {
        $(this).removeClass('animated '+ animation);
      }else{
        $(this).removeClass('animated infinite '+ animation);
      }
      
  })
  
  }

  
  addHoverAnimation('#sidebar li','fadeIn')
  addHoverAnimation('nav ul li', 'fadeIn')
  get_user_details()
  

  function parseJwt (token) {
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace('-', '+').replace('_', '/');
    return JSON.parse(window.atob(base64));
  };

  function get_user_details(){ 
    //First identify the user from token
    user_details = parseJwt(localStorage.getItem('key_id'))
    console.log(user_details.email)
    axios({
    method: 'get',
    url: 'https://gtcube.herokuapp.com/seller/sellerdetail/'+user_details.email,
    }).then(function(response){
    //Successful response
    if(response.data){
    //Received the data
    get_profile_data(response.data['id'])
    user_id = response.data['id']
    
    }
    }).catch(function(error){
    console.log(error.response)
    
    });

  }

 function get_profile_data(user_id){
   //1. Collect the details from GET request
  axios({
  method: 'get',
  url: 'https://gtcube.herokuapp.com/seller/profile/'+user_id,
  headers: { Authorization: "JWT "+localStorage.getItem('key_id') },
}).then(function(response){
  //Successful response
  if(response.data){
    //Received the data
    //Add display image
    //$('#display_image').html('<img width=90% src="'+response.data['display_image']+'"></img><p>Display Picture</p>')
    //Fill the fields
    $('#email').val(response.data['email'])
    $('#phone').val(response.data['phone'])
    $('#country').val(response.data['country'])
  }
  }).catch(function(error){
    console.log(error.response)
  });
 }
  
 //2. Update the details with POST request
$('#update_button').click(function(){
   

  //Input fields updating
  var email = $('#email').val()
  var phone = $('#phone').val()
  var country = $("#country").val()

  formData.append("email", email);
  formData.append("phone", phone);
  formData.append("country", country);
  //formData.append("display_image", $("#display_image_field")[0].files[0]);

  axios({
  method: 'put',
  url: 'https://gtcube.herokuapp.com/seller/profile/'+user_id+'/',
  headers: { Authorization: "JWT "+localStorage.getItem('key_id') },
  /* headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json'
  },*/
  data: formData
}).then(function(response){
    get_profile_data(user_id)
  console.log(response.data)
  }).catch(function(error){
    console.log(error.response)
  });

})  

})

</script>

</html>